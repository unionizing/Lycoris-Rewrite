-- ExploitTab module.
local ExploitTab = {}

---@module Features.Game.Teleport
local Teleport = require("Features/Game/Teleport")

---Initialize Mob Exploits section.
---@param groupbox table
function ExploitTab.initMobExploitsSection(groupbox)
	local voidMobsToggle = groupbox:AddToggle("VoidMobs", {
		Text = "Void Mobs",
		Tooltip = "Teleport nearby mobs and send them to the void.",
		Default = false,
	})

	voidMobsToggle:AddKeyPicker("VoidMobsKeyBind", { Default = "N/A", SyncToggleState = true, Text = "Void Mobs" })
end

---Initialize Local Character Exploits section.
---@param groupbox table
function ExploitTab.initLocalCharacterExploitsSection(groupbox)
	local moveWhileKnockedToggle = groupbox:AddToggle("MoveWhileKnocked", {
		Text = "Move While Knocked",
		Tooltip = "Move your character while in a knocked down state.",
		Default = false,
	})

	moveWhileKnockedToggle:AddKeyPicker(
		"MoveWhileKnockedKeyBind",
		{ Default = "N/A", SyncToggleState = true, Text = "Move While Knocked" }
	)
end

---Add teleport button with disclaimer.
---@param groupbox table
---@param text string
---@param dest string
local function addTeleportButton(groupbox, text, dest)
	groupbox:AddButton({
		Text = text,
		Tooltip = "All teleports can bug out and cause death. They also may be very visible to other players.",
		DoubleClick = true,
		DoubleClickText = "Use at your own risk?",
		Func = function()
			Teleport.start(dest)
		end,
	})
end

---Initialize Teleports section.
---@param tabbox table
function ExploitTab.initTeleportsSection(tabbox)
	if game.PlaceId == 5735553160 then
		return
	end

	local teleportsTab = tabbox:AddTab("Teleports")
	local guildDoorTab = tabbox:AddTab("Guild Door")

	if game.PlaceId == 6032399813 then
		addTeleportButton(teleportsTab, "Teleport to Eastern Luminant", "EasternLuminant")
		addTeleportButton(teleportsTab, "Teleport to Trial Of One", "TrialOfOne")
		addTeleportButton(teleportsTab, "Teleport to Lower Erisia", "LowerErisia")
	end

	if game.PlaceId == 6473861193 then
		addTeleportButton(teleportsTab, "Teleport to Etrean Luminant", "EtreanLuminant")
	end

	addTeleportButton(teleportsTab, "Teleport to Depths", "Depths")
	addTeleportButton(teleportsTab, "Teleport to Voidheart", "Voidheart")

	teleportsTab:AddButton("Stop Teleporting", Teleport.stop)

	guildDoorTab:AddInput("GuildDoorName", {
		Text = "Guild Door Name",
		Placeholder = "Exact or partial name of door.",
	})

	addTeleportButton(guildDoorTab, "Teleport To Guild Door", "GuildDoor")
end

---Initialize tab.
---@param window table
function ExploitTab.init(window)
	-- Create tab.
	local tab = window:AddTab("Exploit")

	-- Initialize sections.
	ExploitTab.initMobExploitsSection(tab:AddDynamicGroupbox("Mob Exploits"))
	ExploitTab.initLocalCharacterExploitsSection(tab:AddDynamicGroupbox("Local Character Exploits"))
	ExploitTab.initTeleportsSection(tab:AddDynamicTabbox("Teleports"))
end

-- Return ExploitTab module.
return ExploitTab
